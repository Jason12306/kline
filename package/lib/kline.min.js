!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VyKline=e()}(this,(function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function e(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var i=function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t};function a(t,e){return t(e={exports:{}},e.exports),e.exports}var n=a((function(t){function e(i,a){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(i,a)}t.exports=e}));var r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)},o=a((function(t){function e(i){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(i)}t.exports=e}));var c=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var s=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?c(t):e},l=a((function(t){function e(i){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(i)}t.exports=e})),h={$createElement:function(t){return document.createElement(t)},$setElementAttribute:function(t,e,i){if("object"===o(i))for(var a in i)t[e][a]=i[a];else t.setAttribute(e,i)},$removeElementAttribute:function(t,e,i){t.removeAttribute(e,i)},$getElementAttribute:function(t,e){return t.getAttribute(e)}};function u(t,e){var i=(t=t<10?"0".concat(t):t).length,a=e.length>=t.length?i:e.length;return t.slice(i-a,i)}var d={Y:function(t,e){return u(String(t.getFullYear()),e)},M:function(t,e){return u(String(t.getMonth()+1),e)},D:function(t,e){return u(String(t.getDate()),e)},H:function(t,e){return u(String(t.getHours()),e)},m:function(t,e){return u(String(t.getMinutes()),e)},s:function(t,e){return u(String(t.getSeconds()),e)}},_=new(function(){function e(){t(this,e)}return i(e,[{key:"format",value:function(t,e){var i=t;if(!(t instanceof Date)&&(i=new Date(t),"Invalid Date"===String(i)))throw new Error("Invalid Date");return e.replace(/Y{1,}|M{1,}|D{1,}|H{1,}|m{1,}|s{1,}/g,(function(t){return d[t[0]](i,t)}))}}]),e}()),f={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e}};function m(t){for(var e,i=arguments.length,a=1;a<i;a++)e=1===a?arguments[a]:f[t](e,arguments[a]);return e}var v={},p=function(){function e(){t(this,e)}return i(e,[{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;v[t]&&v[t].forEach((function(t){t(e)}))}},{key:"on",value:function(t,e){v[t]||(v[t]=[]),v[t].push(e)}}]),e}(),x=function(){function e(i){var a=this,n=i.state;t(this,e),this.state={};var r=this,o=function(t){Object.defineProperty(a.state,t,{configurable:!1,enumerable:!0,get:function(){return n[t]},set:function(e){void 0!==r[t]&&(n[t]=e)}})};for(var c in n)o(c)}return i(e,[{key:"commit",value:function(t,e){this[t]=t,this.state[t]=e}}]),e}(),y={DEFAULT_COLUMN_WIDTH:5,DEFAULT_COLUMN_SPACE:1,VIEW_CHANGE_TRIGGER_WAY:{SCALE:"SCALE"},CHART_TYPE:{KLINE:"KLINE",REAL_TIME:"REAL_TIME",EMPTY_KLINE:"EMPTY_KLINE"},WATCHER_EVENT:{DRAG_MOUSE_MOVING:"dragMouseMoving",MOUSE_SCALING:"mouseScaling",ONE_DATA_UPDATED:"onOneDataUpdated",MOUSE_MOVING:"mouseMoving",REAL_TIME_DATA:"onRealTimeData",HISTORY_DATA_CHANGE:"historyDataChange",SWITCHED_INTERVAL:"switchedInterval",THEME_SWITCHED:"themeSwitched"}},$=window.devicePixelRatio||1,g={scale_step:.2,max_scale:6,min_scale:1,x_axis_height:54,y_axis_width:54,axis_segment:3,default_rise_color:"#53b987",default_fall_color:"#eb4d5c",column_style:"solid",init_offset_x:100,volume_height:100,interval_tool_bar:"30px",theme:{background_color:null,axis_text_color:null,axis_color:null,background_line_color:null,realtime_line_color:null,realtime_area_color:null},precision:2,chart_type:y.CHART_TYPE.KLINE},T={user_config:null,el:null,loadingNode:null,chart_instance:null,vy_chart:null,DEFAULT_COLUMN_WIDTH:y.DEFAULT_COLUMN_WIDTH*$,DEFAULT_COLUMN_SPACE:y.DEFAULT_COLUMN_SPACE*$,column_width:y.DEFAULT_COLUMN_WIDTH*$,column_space:y.DEFAULT_COLUMN_SPACE*$,current_interval:null,kline_data:[],all_kline_data:[],current_data:null,min:null,max:null,kline_canvas:null,current_mouse_coordinates:{x:null,y:null},current_cross_dash_line:{x:null,y:null},cross_is_in_newest_data:null,deedfeeds:null,y_axis_scale_list:[],YTag:null,realtime_tagY:null,axis_font:"".concat(12*$,"px Arial"),current_scale:1,no_scale_offset_x:g.init_offset_x,limit_offset_x:1/4,every_data_px:null,overflow_data_num:0,ma_Lines:[{range:5,lineColor:"#583d7a"},{range:10,lineColor:"#95a4c7"}],chart_type:y.CHART_TYPE.KLINE},E={dark:{background_color:"#131722",axis_text_color:"#ccc",axis_color:"#ccc",background_line_color:"#363c4e",realtime_line_color:"#9397a4",realtime_area_color:"rgba(70, 80, 120, 0.6)"},light:{background_color:"#fff",axis_text_color:"#50535e",axis_color:"#50535e",background_line_color:"#e1ecf2",realtime_line_color:"#2196f3",realtime_area_color:"rgba(30, 150, 240, 0.2)"}};function w(t){return JSON.parse(JSON.stringify(t))}var b=new function e(){t(this,e),this.CONSTANTS=y,this.THEME=E,this.$Od=h,this.$time=_,this.$decimal=m,this.$copyObjectUnsafe=w,this.$watcher=new p,this.$store=new x({state:Object.assign(T,g)}),this.$handleCanvasDrawValue=function(t){return Math.round(t)+.5},this.$devicePixelRatio=window.devicePixelRatio||1},R=function(){function e(){for(var i in t(this,e),b)this[i]=b[i]}return i(e,[{key:"_customChart",value:function(t){var e=Object.keys(g),i=this.$store.state.user_config.theme,a=t;for(var n in a.chartType||(a.chartType=g.chart_type),E[i]||(i=a.theme||"light"),a=Object.assign({},{theme:E[i]},a))e.includes(n)&&this.$store.commit(n,a[n]);a.init_offset_x&&this.$store.commit("no_scale_offset_x",a.init_offset_x),this.$store.commit("chart_type",a.chartType)}},{key:"_clearScreen",value:function(t,e,i){t.clearRect(0,0,e,i)}},{key:"_drawBackground",value:function(t,e,i){t.beginPath(),t.globalAlpha=1,t.fillStyle=this.$store.state.theme.background_color,t.fillRect(0,0,e,i)}},{key:"_handleDevicePixelRatio",value:function(t){var e=t.symbol,i=void 0===e?"*":e,a=t.value;return this.$decimal(i,a,this.$devicePixelRatio)}}]),e}();function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var A=new(function(e){r(n,e);var a=D(n);function n(){return t(this,n),a.apply(this,arguments)}return i(n,[{key:"draw",value:function(t){var e=this,i=t.ctx;this._ctx=i,this.$store.state.kline_data.forEach((function(t){var i=t.x,a=t.columnStartY,n=t.columnHeight,r=t.close,o=t.open,c=t.candleLineStartY,s=t.candleLineHeight,l=e.$store.state,h=l.column_width,u=l.default_rise_color,d=l.default_fall_color;e._ctx.strokeStyle=e._ctx.fillStyle=r>=o?u:d,e._ctx.lineWidth=1;var _=e.$handleCanvasDrawValue(e.$decimal("+",i,Math.floor(h/2)));e._ctx.beginPath(),e._ctx.moveTo(_,c),e._ctx.lineTo(_,c+s),e._ctx.lineWidth=1,e._ctx.stroke(),e._ctx.fillRect(Math.round(i),a,h,n)}))}}]),n}(R));function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var k=new(function(e){r(n,e);var a=C(n);function n(){return t(this,n),a.apply(this,arguments)}return i(n,[{key:"draw",value:function(t){var e=this,i=t.ctx,a=t.c;this._ctx=i,this.c=a,this._ctx.beginPath();var n=this.$store.state,r=n.kline_data,o=n.column_width,c=n.theme,s=c.realtime_line_color,l=c.realtime_area_color;r.forEach((function(t,i){var a=t.x,n=t.columnStartY,r=t.columnHeight,c=t.isRise,s=e.$handleCanvasDrawValue(e.$decimal("+",a,Math.floor(o/2))),l=c?n:e.$decimal("+",n,r);i?e._ctx.lineTo(s,l):e._ctx.moveTo(s,l)}));var h=r[0],u=r[r.length-1],d=this.$handleCanvasDrawValue(this.$decimal("+",u.x,Math.floor(o/2))),_=this.$handleCanvasDrawValue(this.$decimal("+",h.x,Math.floor(o/2)));this._ctx.lineTo(d,this.c.height+1),this._ctx.lineTo(_,this.c.height+1),this._ctx.lineWidth=1,this._ctx.strokeStyle=s,this._ctx.fillStyle=l,this._ctx.stroke(),this._ctx.fill()}}]),n}(R));function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var S=new(function(e){r(n,e);var a=M(n);function n(){return t(this,n),a.apply(this,arguments)}return i(n,[{key:"draw",value:function(t){var e=this,i=t.ctx;this._ctx=i,this.$store.state.kline_data.forEach((function(t,i,a){var n=t.x,r=t.columnStartY,o=t.columnHeight,c=t.close,s=(t.open,t.candleLineStartY),l=t.candleLineHeight,h=e.$store.state,u=h.column_width,d=h.default_rise_color,_=h.default_fall_color,f=!a[i+1]||c-a[i+1].close>=0;e._ctx.strokeStyle=e._ctx.fillStyle=f?d:_,e._ctx.lineWidth=1;var m=e.$devicePixelRatio%2==0?.5:0,v=Math.round(n)+.5,p=Math.round(n)+m,x=e.$handleCanvasDrawValue(e.$decimal("+",p,Math.floor(u/2)));e._ctx.beginPath(),e._ctx.moveTo(x,s),e._ctx.lineTo(x,r),e._ctx.moveTo(x,e.$decimal("+",r,o)),e._ctx.lineTo(x,e.$decimal("+",s,l)),e._ctx.lineWidth=1,e._ctx.stroke(),t.isRise?e._ctx.strokeRect(v,r,u,o):e._ctx.fillRect(p,r,u,o)}))}}]),n}(R));var O=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t};function P(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function H(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?P(Object(i),!0).forEach((function(e){O(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var L=function(e){r(n,e);var a=N(n);function n(e){var i,r=e._ctx,o=e.range;return t(this,n),(i=a.call(this))._ctx=r,i.range=o,i}return i(n,[{key:"draw",value:function(){var t=this._handleMALineData();this._drawMALine(t)}},{key:"_handleMALineData",value:function(){var t=this,e=[],i=[];return this.$store.state.all_kline_data.slice(this.$store.state.overflow_data_num,2*this.$store.state.kline_data.length+this.$store.state.overflow_data_num).forEach((function(a,n,r){if(!(r.length-t.range-n<0)){i=r.slice(n,n+t.range);var o=H(H({},a),{},{avgClose:0}),c=0;i.forEach((function(e){c=t.$decimal("+",c,e.close)})),o.avgClose=t.$decimal("/",c,t.range),e.push(o),t.$store.state.kline_data[n]&&(t.$store.state.kline_data[n]["MAClose".concat(t.range)]=o.avgClose),i=[]}})),(e=e.slice(0,this.$store.state.kline_data.length)).forEach((function(e,i){Object.assign(e,t.$store.state.kline_data[i])})),e}},{key:"_drawMALine",value:function(t){var e=this;this._ctx.beginPath();var i=this.$store.state,a=i.el,n=i.x_axis_height,r=i.volume_height,o=i.min,c=i.every_data_px,s=i.column_width,l=a.offsetHeight,h=this.$decimal("-",l,n,r)*this.$devicePixelRatio;t.forEach((function(t,i,a){var n=e.$decimal("+",t.x,s/2),r=e.$decimal("-",h,(t.avgClose-o)*c);i?e._ctx.lineTo(n,r):(e._ctx.beginPath(),e._ctx.moveTo(n,r))})),this._ctx.stroke()}}]),n}(R);function I(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var W=function(e){r(n,e);var a=I(n);function n(){var e;return t(this,n),(e=a.call(this)).c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetWidth,e.$store.state.y_axis_width)}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetHeight,e.$store.state.x_axis_height,e.$store.state.volume_height)}),e.c.style.position="absolute",e.c.style.top=0,e.c.style.left=0,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$watcher.on(y.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.dragMouseMoving.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.MOUSE_SCALING,e.mouseScaling.bind(c(e))),e.mALineInstanceList=[],e.$store.state.ma_Lines.forEach((function(t){var i=new L({_ctx:e._ctx,range:t.range});e.mALineInstanceList.push(i)})),e}return i(n,[{key:"drawHistory",value:function(){var t=this,e=this.$store.state,i=e.y_axis_scale_list,a=e.chart_type,n=e.theme.background_line_color;switch(this._clearScreen(this._ctx,this.c.width,this.c.height),this._drawBackground(this._ctx,this.c.width,this.c.height),this._ctx.setLineDash([0]),i.forEach((function(e){t._ctx.beginPath(),t._ctx.strokeStyle=n,t._ctx.lineWidth=1;var i=Math.round(e)-.5;t._ctx.moveTo(0,i),t._ctx.lineTo(t.c.width,i),t._ctx.stroke()})),this._ctx.strokeStyle=this.$store.state.ma_Lines[0].lineColor,this.mALineInstanceList[0].draw(),this._ctx.strokeStyle=this.$store.state.ma_Lines[1].lineColor,this.mALineInstanceList[1].draw(),a){case this.CONSTANTS.CHART_TYPE.KLINE:A.draw({ctx:this._ctx});break;case this.CONSTANTS.CHART_TYPE.REAL_TIME:k.draw({ctx:this._ctx,c:this.c});break;case this.CONSTANTS.CHART_TYPE.EMPTY_KLINE:S.draw({ctx:this._ctx});break;default:A.draw({ctx:this._ctx})}this.drawRealTimeLine()}},{key:"drawRealTimeLine",value:function(){var t=this.$store.state,e=t.max,i=t.min,a=t.all_kline_data,n=t.default_rise_color,r=t.default_fall_color,o=t.realtime_tagY,c=t.precision,s=a[0],l=s.close,h=s.open,u=(s.low,s.high,this.$decimal("-",e,i)),d=this.$decimal("/",this.c.height,u),_=this.$decimal("*",d,Math.abs(this.$decimal("-",h,l))),f=Math.min(h,l),m=this.$decimal("-",this.c.height,(f-i)*d,_),v=l>=h,p=v?n:r,x=v?m:this.$decimal("+",m,_);this._ctx.strokeStyle=p,this._ctx.beginPath(),this._ctx.lineWidth=1,this._ctx.setLineDash([2]),this._ctx.moveTo(0,x),this._ctx.lineTo(this.c.width,x),this._ctx.stroke(),o.innerText=l.toFixed(c),this.$Od.$setElementAttribute(o,"style",{top:"".concat(this._handleDevicePixelRatio({symbol:"/",value:x})-8,"px"),backgroundColor:p})}},{key:"dragMouseMoving",value:function(){this.drawHistory()}},{key:"mouseScaling",value:function(){this.drawHistory()}}]),n}(R);var V=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a};var Y=function(t){if(Array.isArray(t))return V(t)};var U=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)};var X=function(t,e){if(t){if("string"==typeof t)return V(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?V(t,e):void 0}};var G=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var F=function(t){return Y(t)||U(t)||X(t)||G()};function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var B=function(e){r(n,e);var a=j(n);function n(){return t(this,n),a.apply(this,arguments)}return i(n,[{key:"dealCanDrawViewData",value:function(t){var e,i=this,a=this.$store.state,n=a.el,r=a.x_axis_height,o=a.y_axis_width,c=a.column_space,s=a.column_width,l=a.init_offset_x,h=a.volume_height,u=n.offsetWidth,d=n.offsetHeight,_=this.$decimal("-",u,o)*this.$devicePixelRatio,f=this.$decimal("-",d,r,h)*this.$devicePixelRatio,m=this.$decimal("+",c,s),v=Math.ceil(_/m)+1,p=0,x=0;if(l>=0)e=this.$copyObjectUnsafe(t.slice(0,v));else{var y=Math.abs(l);x=Math.floor(this.$decimal("/",y,m)),p=this.$decimal("-",_,-y,this.$decimal("*",x,m),s),e=this.$copyObjectUnsafe(t.slice(x,x+v))}this.$store.commit("overflow_data_num",x);var $=e.map((function(t){return t.high})),g=e.map((function(t){return t.low})),T=Math.max.apply(Math,F($)),E=Math.min.apply(Math,F(g)),w=this.$decimal("-",T,E),b=this.$decimal("/",f,w);this.$store.commit("every_data_px",b);var R=e.map((function(t,e){var a=i.$decimal("*",m,e);t.x=l>=0?i.$decimal("-",_,l,a,s):i.$decimal("-",p,a),t.candleLineHeight=Math.round(i.$decimal("*",b,i.$decimal("-",t.high,t.low))),t.candleLineStartY=Math.round(i.$decimal("-",f,(t.low-E)*b,t.candleLineHeight));var n=Math.min(t.open,t.close);return t.columnHeight=Math.round(i.$decimal("*",b,Math.abs(i.$decimal("-",t.open,t.close)))),t.columnStartY=Math.round(i.$decimal("-",f,(n-E)*b,t.columnHeight)),t.isRise=t.close>=t.open,t}));this.$store.commit("kline_data",R),this.$store.commit("max",T),this.$store.commit("min",E)}}]),n}(R);function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var z=function(e){r(n,e);var a=K(n);function n(){var e;return t(this,n),(e=a.call(this)).mousemoveThrottleTimer=null,e.mousewheelThrottleTimer=null,e.c=e.$Od.$createElement("canvas"),e.c.style.position="absolute",e.c.style.zIndex=100,e.c.style.top=0,e.c.style.left=0,e.c.style.cursor="crosshair",e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetWidth,e.$store.state.y_axis_width)}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetHeight,e.$store.state.x_axis_height)}),e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.c.addEventListener("mousedown",e.mousedown.bind(c(e))),e.c.addEventListener("mouseup",e.mouseup.bind(c(e))),e.c.addEventListener("mousemove",e.mousemove.bind(c(e))),e.c.addEventListener("mouseleave",e.mouseleave.bind(c(e))),e.c.addEventListener("mouseenter",e.mouseenter.bind(c(e))),e.c.addEventListener("mousewheel",e.mousewheel.bind(c(e))),e.c.addEventListener("DOMMouseScroll",e.mousewheel.bind(c(e))),e.c.addEventListener("contextmenu",e.contextmenu.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.ONE_DATA_UPDATED,e.onOneDataUpdated.bind(c(e))),e.tagY=null,e.tagX=null,e.realTimeTagY=null,e.createXTag(),e.createYTag(),e.createRealTimeYTag(),e.INIT_OFFSET_X=e.$store.state.init_offset_x,e.limitOffsetX=e.$decimal("*",e.c.width,1-e.$store.state.limit_offset_x),e}return i(n,[{key:"drawCrossDottedLine",value:function(t,e){var i=e.x,a=e.y;this.$store.commit("current_cross_dash_line",{x:i,y:a});var n=this.$store.state,r=n.max,o=n.min,c=n.kline_data,s=n.column_width,l=n.volume_height,h=c[0].x,u=h<=i&&i<=this.$decimal("+",h,s);this.$store.commit("cross_is_in_newest_data",u);var d=this.$store.state.current_data.time,_=this._handleDevicePixelRatio({value:l}),f=this.$decimal("-",r,o),m=this.$decimal("/",f,this.c.height-_),v=this.$decimal("-",this.c.height,_,a),p=this.$decimal("+",this.$decimal("*",m,v),o);a>this.c.height-_?this.tagY.style.display="none":this.tagY.style.display="block",this.tagY.innerText=p.toFixed(2),this.tagY.style.top="".concat(this._handleDevicePixelRatio({symbol:"/",value:a})-8,"px"),this.tagX.innerText=this.$time.format(d,"YYYY-MM-DD HH:mm"),this.tagX.style.left="".concat(i/this.$devicePixelRatio,"px"),this._ctx.setLineDash([5]),this._ctx.strokeStyle="#758696",this._ctx.beginPath(),this._ctx.moveTo(0,a-.5),this._ctx.lineTo(this.c.width,a-.5),this._ctx.stroke(),this._ctx.beginPath();var x=this.$decimal("+",i,Math.ceil(this.$store.state.column_width/2))-.5;this._ctx.moveTo(x,0),this._ctx.lineTo(x,this.c.height),this._ctx.stroke()}},{key:"dragMousemove",value:function(t){var e=this.$store.state,i=e.all_kline_data,a=e.current_scale,n=e.init_offset_x;this.$store.commit("no_scale_offset_x",this.$decimal("/",n,a));var r=this.$decimal("*",this.$devicePixelRatio,this.$decimal("-",this.startDragX,t.layerX)),o=this.$decimal("+",this.INIT_OFFSET_X,r);o>this.limitOffsetX&&(o=this.limitOffsetX),this.$store.commit("init_offset_x",o),this.dealCanDrawViewData(i),this.$watcher.emit(y.WATCHER_EVENT.DRAG_MOUSE_MOVING)}},{key:"clearScreen",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height)}},{key:"mousemove",value:function(t){var e=this;null===this.mousemoveThrottleTimer&&(this.mousemoveThrottleTimer=window.requestAnimationFrame((function(){e.$store.commit("current_mouse_coordinates",{x:t.layerX*e.$devicePixelRatio,y:t.layerY*e.$devicePixelRatio}),e.canDragable?e.dragMousemove(t):e.$store.state.kline_data.every((function(i){var a=e.$decimal("+",i.x,e.$store.state.column_width);return!(i.x<=t.layerX*e.$devicePixelRatio&&i.x<=a)||(e.$store.commit("current_data",i),e.clearScreen(),e.drawCrossDottedLine(t,{x:i.x,y:t.layerY*e.$devicePixelRatio}),!1)})),e.$watcher.emit(y.WATCHER_EVENT.MOUSE_MOVING),window.cancelAnimationFrame(e.mousemoveThrottleTimer),e.mousemoveThrottleTimer=null})))}},{key:"mousewheel",value:function(t){var e=this;null===this.mousewheelThrottleTimer&&(this.mousewheelThrottleTimer=window.requestAnimationFrame((function(){var i=e.$store.state,a=i.scale_step,n=i.max_scale,r=i.min_scale,o=i.current_scale,c=i.all_kline_data,s=i.DEFAULT_COLUMN_WIDTH,l=i.DEFAULT_COLUMN_SPACE,h=i.no_scale_offset_x,u=o;t.deltaY<0||t.detail<0?e.$decimal("*",h,u)<=e.limitOffsetX&&o<n&&(u=e.$decimal("+",o,a)):o>r&&(u=e.$decimal("-",o,a)),e.$store.commit("current_scale",u);var d=e.$store.state.current_scale;e.$store.commit("init_offset_x",e.$decimal("*",h,d)),e.INIT_OFFSET_X=e.$store.state.init_offset_x,e.$store.commit("column_width",e.$decimal("*",s,d)),e.$store.commit("column_space",e.$decimal("*",l,d)),e.dealCanDrawViewData(c),e.$watcher.emit(y.WATCHER_EVENT.MOUSE_SCALING),window.cancelAnimationFrame(e.mousewheelThrottleTimer),e.mousewheelThrottleTimer=null})))}},{key:"mouseenter",value:function(){var t=this,e=setTimeout((function(){t.tagX.style.display="block",t.tagY.style.display="block",clearTimeout(e)}),50);e=null}},{key:"mouseleave",value:function(){var t=this;this.canDragable=!1,this.INIT_OFFSET_X=this.$store.state.init_offset_x;var e=setTimeout((function(){t.tagX.style.display="none",t.tagY.style.display="none",t.$store.commit("cross_is_in_newest_data",null),t.clearScreen(),clearTimeout(e)}),50);e=null}},{key:"mousedown",value:function(t){t.button||(this.startDragX=t.layerX,this.canDragable=!0,this.$Od.$setElementAttribute(this.c,"class","is-grabbing"))}},{key:"mouseup",value:function(t){t.button||(this.canDragable=!1,this.INIT_OFFSET_X=this.$store.state.init_offset_x,this.$Od.$removeElementAttribute(this.c,"class","is-grabbing"))}},{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"createRealTimeYTag",value:function(){this.realTimeTagY=this.$Od.$createElement("div"),this.$Od.$setElementAttribute(this.realTimeTagY,"id","real_time_volume"),this.$Od.$setElementAttribute(this.realTimeTagY,"style",{position:"absolute",zIndex:"80",right:0,width:"".concat(this.$store.state.y_axis_width,"px"),fontSize:"12px",textAlign:"center",color:"#fff",userSelect:"none"}),this.$store.state.vy_chart.appendChild(this.realTimeTagY),this.$store.commit("realtime_tagY",this.realTimeTagY)}},{key:"createYTag",value:function(){this.tagY=this.$Od.$createElement("div"),this.$Od.$setElementAttribute(this.tagY,"id","volume"),this.$Od.$setElementAttribute(this.tagY,"style",{position:"absolute",zIndex:"100",right:0,width:"".concat(this.$store.state.y_axis_width,"px"),fontSize:"12px",textAlign:"center",color:"#fff",backgroundColor:"#585858",userSelect:"none"}),this.$store.state.vy_chart.appendChild(this.tagY),this.$store.commit("YTag",this.tagY)}},{key:"createXTag",value:function(){this.tagX=this.$Od.$createElement("div"),this.$Od.$setElementAttribute(this.tagX,"id","date-time"),this.$Od.$setElementAttribute(this.tagX,"style",{position:"absolute",zIndex:"100",bottom:"".concat(this.$store.state.x_axis_height-44,"px"),fontSize:"12px",color:"#fff",backgroundColor:"#585858",transform:"translate(-50%, 0)",whiteSpace:"noWrap",userSelect:"none"}),this.$store.state.vy_chart.appendChild(this.tagX)}},{key:"onOneDataUpdated",value:function(t){this.$store.state.cross_is_in_newest_data&&(this.tagX.innerText=this.$time.format(t.time,"YYYY-MM-DD HH:mm"))}}]),n}(B);function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var J=function(e){r(n,e);var a=q(n);function n(){var e;t(this,n);var i=(e=a.call(this)).$store.state,r=i.el,o=i.x_axis_height,s=i.y_axis_width,l=i.volume_height;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:s}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",r.offsetHeight,o,l)}),e.c.style.position="absolute",e.c.style.top=0,e.c.style.right=0,e.c.style.background=e.$store.state.background_color,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$watcher.on(y.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.MOUSE_SCALING,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.REAL_TIME_DATA,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.HISTORY_DATA_CHANGE,e.reDraw.bind(c(e))),e}return i(n,[{key:"draw",value:function(){this._drawBackground(this._ctx,this.c.width,this.c.height);var t=this.$store.state,e=t.theme,i=t.min,a=t.max,n=t.axis_segment,r=t.axis_font,o=e.axis_color,c=e.axis_text_color;this._ctx.moveTo(.5,0),this._ctx.lineTo(.5,this.c.height),this._ctx.lineWidth=1,this._ctx.strokeStyle=o,this._ctx.stroke();for(var s=m("/",this.c.height,m("-",a,i)),l=0,h=Math.trunc(Math.log10(i))-1,u=Math.trunc(i/Math.pow(10,h))*Math.pow(10,h),d=Math.ceil(Math.log10(a-i))-2,_=5*Math.pow(10,d),f=5*Math.pow(10,d);_*s<40;)_=this.$decimal("+",_,f);this._ctx.strokeStyle=o,this._ctx.fillStyle=c,this._ctx.font=r;for(var v=[];u+_*l<a;){var p=u+_*l;p=p.toFixed(2);var x=this.c.height-s*(p-i),y=x-.5;v.push(y),this._ctx.beginPath(),this._ctx.moveTo(0,y),this._ctx.lineTo(n,y),this._ctx.lineWidth=1,this._ctx.stroke(),this._ctx.fillText(p,5,x+4),l++}this.$store.commit("y_axis_scale_list",v)}},{key:"reDraw",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}}]),n}(R);function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var Z={m:function(t){return{time:Math.trunc(t.time/6e4),format:"HH:mm"}},h:function(t){return{time:Math.trunc(t.time/36e5),format:"DD HH:mm"}},d:function(t){return{time:Math.trunc(t.time/864e5),format:"MM-DD"}},w:function(t){return{time:Math.trunc(t.time/6048e5),format:"MM-DD"}},M:function(t){return{time:Math.trunc(t.time/2592e6),format:"YYYY-MM"}}},tt=function(e){r(n,e);var a=Q(n);function n(){var e;t(this,n);var i=(e=a.call(this)).$store.state,r=i.el,o=i.x_axis_height,s=i.y_axis_width;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",r.offsetWidth,s)}),e.c.height=e._handleDevicePixelRatio({value:o}),e.c.style.position="absolute",e.c.style.bottom=0,e.c.style.left=0,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e.c.style.background=e.$store.state.background_color,e._ctx=e.c.getContext("2d"),e.$watcher.on(y.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.MOUSE_SCALING,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.REAL_TIME_DATA,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.HISTORY_DATA_CHANGE,e.reDraw.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.THEME_SWITCHED,(function(t){e.draw()})),e}return i(n,[{key:"draw",value:function(){var t=this;this._drawBackground(this._ctx,this.c.width,this.c.height);var e=this.$store.state,i=e.theme,a=e.axis_font,n=e.kline_data,r=e.current_scale,o=e.current_interval,c=e.column_width,s=e.axis_segment,l=i.axis_text_color,h=i.axis_color;if(n){this._ctx.moveTo(0,.5),this._ctx.lineTo(this.c.width,.5),this._ctx.lineWidth=1,this._ctx.strokeStyle=h,this._ctx.stroke(),this._ctx.textAlign="center";var u=o.match(/[0-9]*$/),d=o[0];this._ctx.strokeStyle=h,this._ctx.fillStyle=l,this._ctx.font=a,n.forEach((function(e,i){var a=Z[d](e),n=a.time,o=a.format,l=Math.trunc(10*u/r);if(!(n%(l=5*Math.ceil(l/5)))){var h=t.$decimal("+",e.x,Math.ceil(c/2));t._ctx.beginPath(),t._ctx.moveTo(h-.5,0),t._ctx.lineTo(h-.5,s*t.$devicePixelRatio),t._ctx.stroke();var _=t.$time.format(e.time,o);t._ctx.fillText(_,h,15*t.$devicePixelRatio)}}))}}},{key:"reDraw",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}}]),n}(R);function et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var it=function(e){r(n,e);var a=et(n);function n(){var e;t(this,n);var i=(e=a.call(this)).$store.state,r=i.el,o=i.x_axis_height,s=i.y_axis_width,l=i.volume_height;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",r.offsetWidth,s)}),e.c.height=e._handleDevicePixelRatio({value:l}),e.c.style.position="absolute",e.c.style.bottom="".concat(o,"px"),e.c.style.left=0,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.maxVolume=null,e.minVolume=null,e.dataGap=null,e.everyDataPX=null,e.YAxisStartX=e.$decimal("-",e._handleDevicePixelRatio({value:e.c.width}),s),e.$watcher.on(y.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.dragMouseMoving.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.MOUSE_SCALING,e.mouseScaling.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.REAL_TIME_DATA,e.onRealTimeData.bind(c(e))),e}return i(n,[{key:"drawTopLine",value:function(){var t=this.$store.state.theme.axis_color;this._ctx.strokeStyle=t,this._ctx.beginPath(),this._ctx.moveTo(0,.5),this._ctx.lineTo(this.c.width,.5),this._ctx.lineWidth=1,this._ctx.stroke()}},{key:"draw",value:function(){var t=this;this._clearScreen(this._ctx,this.c.width,this.c.height),this._drawBackground(this._ctx,this.c.width,this.c.height),this.drawTopLine();var e=this.$store.state,i=e.kline_data,a=(e.volume_height,e.current_scale,e.y_axis_width,e.column_width),n=e.default_rise_color,r=e.default_fall_color,o=i.map((function(t){return t.volume}));this.maxVolume=Math.max.apply(Math,F(o)),this.minVolume=Math.min.apply(Math,F(o)),this.dataGap=this.$decimal("-",this.maxVolume,this.minVolume),this.everyDataPX=this.$decimal("/",this.c.height,this.dataGap),i.forEach((function(e){t._ctx.beginPath(),t._ctx.strokeStyle=t._ctx.fillStyle=e.close>=e.open?n:r;var i=t.$decimal("-",e.volume,t.minVolume),o=t.$decimal("*",t.everyDataPX,i),c=t.$decimal("-",t.c.height,o),s=e.x-.5;t._ctx.strokeRect(s,c,a,o),t._ctx.globalAlpha=.6,t._ctx.fillRect(s,c,a,o)}))}},{key:"dragMouseMoving",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height),this.draw()}},{key:"mouseScaling",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height),this.draw()}},{key:"onRealTimeData",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height),this.draw()}}]),n}(R);function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var nt=function(){function e(i,a){var n=a.data,r=void 0===n?0:n,o=a.html;t(this,e),this.span=i.$createElement("span"),this.html=o,this.data=r,this.span.innerHTML="".concat(o,'=<i style="color: ').concat(this.color,';">').concat(this.data,"</i>")}return i(e,[{key:"setData",value:function(t,e,i){this.data=t,this.span.innerHTML="".concat(this.html,'=<i style="color: ').concat(e,';">').concat(this.data,"</i>"),this.span.style.color=i}}]),e}(),rt=function(e){r(n,e);var a=at(n);function n(){var e;return t(this,n),(e=a.call(this)).dashboardWrapper=e.$Od.$createElement("div"),e.$Od.$setElementAttribute(e.dashboardWrapper,"id","dashboard-wrapper"),e.$Od.$setElementAttribute(e.dashboardWrapper,"style",{position:"absolute",zIndex:"50",left:0,top:0}),e.spanWrapper=e.$Od.$createElement("div"),e.$Od.$setElementAttribute(e.spanWrapper,"id","span-wrapper"),e.dashboardWrapper.appendChild(e.spanWrapper),e.openSpan=new nt(e.$Od,{html:"开"}),e.highSpan=new nt(e.$Od,{html:"高"}),e.lowSpan=new nt(e.$Od,{html:"低"}),e.closeSpan=new nt(e.$Od,{html:"收"}),e.volSpan=new nt(e.$Od,{html:"Vol"}),e.MA5Span=new nt(e.$Od,{html:"MA5"}),e.MA10Span=new nt(e.$Od,{html:"MA10"}),e.spanWrapper.appendChild(e.openSpan.span),e.spanWrapper.appendChild(e.highSpan.span),e.spanWrapper.appendChild(e.lowSpan.span),e.spanWrapper.appendChild(e.closeSpan.span),e.spanWrapper.appendChild(e.volSpan.span),e.spanWrapper.appendChild(e.MA5Span.span),e.spanWrapper.appendChild(e.MA10Span.span),e.$watcher.on(y.WATCHER_EVENT.MOUSE_MOVING,e.mouseMoving.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.REAL_TIME_DATA,e.onRealTimeData.bind(c(e))),e}return i(n,[{key:"setSpanInnerText",value:function(t){var e=t.open,i=t.high,a=t.low,n=t.close,r=t.volume,o=t.MAClose5,c=void 0===o?0:o,s=t.MAClose10,l=void 0===s?0:s,h=this.$store.state,u=h.default_rise_color,d=h.default_fall_color,_=h.axis_text_color,f=h.ma_Lines,m=h.precision,v=n>=e?u:d;this.openSpan.setData(e.toFixed(m),v,_),this.highSpan.setData(i.toFixed(m),v,_),this.lowSpan.setData(a.toFixed(m),v,_),this.closeSpan.setData(n.toFixed(m),v,_),this.volSpan.setData(r,v,_),this.MA5Span.setData(c.toFixed(m),f[0].lineColor,_),this.MA10Span.setData(l.toFixed(m),f[1].lineColor,_)}},{key:"mouseMoving",value:function(){if(this.$store.state.current_data){var t=this.$store.state.current_data,e=t.open,i=t.high,a=t.low,n=t.close,r=t.volume,o=t.MAClose5,c=t.MAClose10;this.setSpanInnerText({open:e,high:i,low:a,close:n,volume:r,MAClose5:o,MAClose10:c})}}},{key:"onRealTimeData",value:function(){var t=this.$store.state,e=t.cross_is_in_newest_data,i=t.kline_data;if(e||null===e){var a=i[0],n=a.open,r=a.high,o=a.low,c=a.close,s=a.volume,l=a.MAClose5,h=a.MAClose10;this.setSpanInnerText({open:n,high:r,low:o,close:c,volume:s,MAClose5:l,MAClose10:h})}}}]),n}(R);function ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var ct=/0{3}$/,st=function(e){r(n,e);var a=ot(n);function n(){var e;t(this,n);var i=(e=a.call(this)).$store.state,r=(i.el,i.x_axis_height),o=i.y_axis_width,s=i.volume_height;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:o}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",s)}),e.c.style.position="absolute",e.c.style.bottom="".concat(e.$decimal("-",r),"px"),e.c.style.right=0,e.c.style.background=e.$store.state.background_color,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$watcher.on(y.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.dragMouseMoving.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.MOUSE_SCALING,e.mouseScaling.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.REAL_TIME_DATA,e.onRealTimeData.bind(c(e))),e.$watcher.on(y.WATCHER_EVENT.THEME_SWITCHED,(function(t){e.draw()})),e}return i(n,[{key:"draw",value:function(){this._drawBackground(this._ctx,this.c.width,this.c.height);var t=this.$store.state.theme.axis_color;this._ctx.strokeStyle=t,this._ctx.beginPath(),this._ctx.moveTo(.5,0),this._ctx.lineTo(.5,this.c.height),this._ctx.lineWidth=1,this._ctx.stroke(),this.drawVolYAxis()}},{key:"drawVolYAxis",value:function(){var t=this.$store.state,e=t.theme,i=t.kline_data,a=t.volume_height,n=t.axis_segment,r=t.axis_font,o=e.axis_text_color,c=i.map((function(t){return t.volume}));this.maxVolume=Math.max.apply(Math,F(c)),this.minVolume=Math.min.apply(Math,F(c)),this.dataGap=this.$decimal("-",this.maxVolume,this.minVolume);var s=this._handleDevicePixelRatio({value:a});this.everyDataPX=this.$decimal("/",s,this.dataGap);for(var l=Math.trunc(Math.log10(this.dataGap))-1,h=Math.trunc(this.minVolume),u=5*Math.pow(10,l),d=u;u*this.everyDataPX<20;)u=this.$decimal("+",u,d);this._ctx.fillStyle=o,this._ctx.font=r;for(var _=1;h+u*_<this.maxVolume;){var f=String(u*_);ct.test(f)&&(f=f.replace(ct,"k"));var m=this.c.height-this.everyDataPX*u*_;this._ctx.beginPath(),this._ctx.moveTo(0,m-.5),this._ctx.lineTo(n,m-.5),this._ctx.lineWidth=1,this._ctx.stroke(),this._ctx.fillText(f,5,m+this._handleDevicePixelRatio({value:4})),_++}}},{key:"dragMouseMoving",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}},{key:"mouseScaling",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}},{key:"onRealTimeData",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}}]),n}(R),lt={m:{text:"Min"},h:{text:"Hour"},d:{text:"Day"},w:{text:"Week"},M:{text:"Mon"}};function ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var ut=function(e){r(n,e);var a=ht(n);function n(){var e;return t(this,n),(e=a.call(this)).c=e.$Od.$createElement("div"),e.throttleTimer=null,e.cacheChartType=e.$store.state.chart_type,e.$Od.$setElementAttribute(e.c,"id","interval_tool_bar"),e.$Od.$setElementAttribute(e.c,"style",{height:e.$store.state.interval_tool_bar,lineHeight:e.$store.state.interval_tool_bar,backgroundColor:e.$store.state.background_color}),e.$store.state.user_config.theme&&e.$Od.$setElementAttribute(e.c,"class",e.$store.state.user_config.theme),e.createTimeShareBtn(),e.createIntervalBtn(),e.$watcher.on(y.WATCHER_EVENT.THEME_SWITCHED,(function(t){e.$Od.$setElementAttribute(e.c,"style",{backgroundColor:e.$store.state.theme.background_color}),e.$Od.$setElementAttribute(e.c,"class",t)})),e}return i(n,[{key:"createIntervalBtn",value:function(){var t=this,e=this.$store.state,i=e.user_config,a=e.chart_instance,n=i.interval,r=i.deedfeeds,o=i.onTimeIntervalChanged;n.forEach((function(e){var i=t.$Od.$createElement("button"),n=e.slice(1);i.innerText="".concat(n," ").concat(lt[e[0]].text),t.$Od.$setElementAttribute(i,"class","interval-item"),t.$Od.$setElementAttribute(i,"data-interval-item",e);var c=t.$store.state,s=c.current_interval,l=c.loadingNode;s===e&&t.$Od.$setElementAttribute(i,"class","interval-item active"),i.onclick=function(){if(!t.throttleTimer){var n=t.$store.state,c=n.current_interval,s=n.chart_type;if(c===e&&s!==t.CONSTANTS.CHART_TYPE.REAL_TIME)return;t.throttleTimer=setTimeout((function(){"function"==typeof o&&o(e),l.style.display="block",t.$store.commit("chart_type",t.cacheChartType),t.$store.commit("all_kline_data",[]),t.$store.commit("kline_data",[]),t.$store.commit("current_interval",e),t.$Od.$setElementAttribute(document.getElementsByClassName("interval-item active")[0],"class","interval-item"),t.$Od.$setElementAttribute(i,"class","interval-item active"),r.intervalChanged({interval:e,setHistoryData:a.initHistoryData,subscribeData:a.getRealTimeData}),t.throttleTimer=null}),200)}},t.c.appendChild(i)}))}},{key:"createTimeShareBtn",value:function(){var t=this,e=this.$store.state,i=e.user_config,a=e.chart_instance,n=e.loadingNode,r=i.deedfeeds,o=this.$Od.$createElement("button");o.innerText="分时",this.$Od.$setElementAttribute(o,"class","interval-item"),this.$Od.$setElementAttribute(o,"data-interval-item","time-sharing"),o.onclick=function(){n.style.display="block",t.cacheChartType=t.$store.state.chart_type,t.$store.commit("chart_type",t.CONSTANTS.CHART_TYPE.REAL_TIME),t.$store.commit("all_kline_data",[]),t.$store.commit("current_interval","m1"),t.$Od.$setElementAttribute(document.getElementsByClassName("interval-item active")[0],"class","interval-item"),t.$Od.$setElementAttribute(o,"class","interval-item active"),r.intervalChanged({interval:"m1",setHistoryData:a.initHistoryData,subscribeData:a.getRealTimeData})},this.c.appendChild(o)}}]),n}(R);function dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var _t=function(e){r(n,e);var a=dt(n);function n(){var e;return t(this,n),(e=a.call(this)).c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$store.state.y_axis_width}),e.c.height=e._handleDevicePixelRatio({value:e.$store.state.x_axis_height}),e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$Od.$setElementAttribute(e.c,"style",{position:"absolute",bottom:0,right:0,background:e.$store.state.theme.background_color}),e.draw(),e.$watcher.on(y.WATCHER_EVENT.THEME_SWITCHED,(function(){e.$Od.$setElementAttribute(e.c,"style",{background:e.$store.state.theme.background_color}),e.draw()})),e}return i(n,[{key:"draw",value:function(){var t=this.$store.state.theme.axis_color;this._ctx.moveTo(0,.5),this._ctx.lineTo(this.c.width,.5),this._ctx.moveTo(.5,0),this._ctx.lineTo(.5,this.c.height),this._ctx.lineWidth=1,this._ctx.strokeStyle=t,this._ctx.stroke()}}]),n}(R);function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return s(this,i)}}var mt=new(function(e){r(n,e);var a=ft(n);function n(){var e;return t(this,n),(e=a.call(this)).customChart=null,e}return i(n,[{key:"bootstrap",value:function(t){var e=t.container,i=t.deedfeeds,a=t.defaultInterval,n=t.customChart,r=t.showIntervalToolbar,o=void 0===r||r,c=t.customLoadingEl;this.$store.commit("user_config",t),this.customChart=n,this._customChart(n),this.$store.commit("deedfeeds",i),this.$store.commit("current_interval",a),c?c instanceof HTMLElement&&(this.loading=c,this.$store.commit("loadingNode",this.loading),e.appendChild(this.loading)):(this.loading=function(t,e,i){var a=t.$createElement("div"),n=t.$createElement("div");return t.$setElementAttribute(a,"id","loading"),t.$setElementAttribute(n,"class","spin"),n.innerText="loading...",t.$setElementAttribute(a,"style",{display:"block",position:"absolute",zIndex:"9527",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255, 0.6)"}),a.appendChild(n),e.appendChild(a),a}(this.$Od,e,this.$store.state),this.$store.commit("loadingNode",this.loading)),this.intervalToolBarInstance=new ut,e.appendChild(this.intervalToolBarInstance.c),this.intervalToolBarInstance.c.style.display=o?"block":"none",this.vyChart=function(t,e,i){var a=t.$createElement("div");return t.$setElementAttribute(a,"id","vy-chart"),t.$setElementAttribute(a,"style",{position:"absolute",bottom:0,width:"100%",height:"calc(100% - ".concat(i.interval_tool_bar,")")}),e.appendChild(a),a}(this.$Od,e,this.$store.state),this.$store.commit("el",this.vyChart),this.$store.commit("vy_chart",this.vyChart),e.style.position="relative",this.container=e,this.deedfeeds=i,this.KlineCanvas=null,this.YAxis=null,this.XAxis=null,this.Dashboard=null,this.VolumeCanvas=null,this.BottomRightBlock=null,this.initHistoryData=this.initHistoryData.bind(this),this.getRealTimeData=this.getRealTimeData.bind(this),i.setHistoryData({interval:a,setHistoryData:this.initHistoryData,subscribeData:this.getRealTimeData})}},{key:"initHistoryData",value:function(t){this.$store.commit("all_kline_data",t),this.dealCanDrawViewData(t),this.KlineCanvas||this.initViewOnce(),this.KlineCanvas.drawHistory(),this.VolumeCanvas.draw(),this.$watcher.emit(y.WATCHER_EVENT.HISTORY_DATA_CHANGE),this.loading.style.display="none"}},{key:"getRealTimeData",value:function(t){if(t.time){var e=this.$store.state.all_kline_data;e[0]&&(e[0].time===t.time?e[0]=t:(e.unshift(t),this.$watcher.emit(y.WATCHER_EVENT.ONE_DATA_UPDATED,t)),this.$store.commit("all_kline_data",e),this.initHistoryData(this.$store.state.all_kline_data),this.$watcher.emit(y.WATCHER_EVENT.REAL_TIME_DATA))}}},{key:"initViewOnce",value:function(){this.KlineCanvas=new W({backgroundColor:"#fff"}),this.$store.commit("kline_canvas",this.KlineCanvas),this.KlineMaskCanvas=new z,this.XAxis=new tt,this.YAxis=new J,this.VolYAxis=new st,this.VolumeCanvas=new it,this.Dashboard=new rt,this.BottomRightBlock=new _t,this.intervalToolBarInstance.c.style.backgroundColor=this.$store.state.background_color,this.XAxis.draw(),this.YAxis.draw(),this.VolYAxis.draw(),this.BottomRightBlock.draw(),this.vyChart.appendChild(this.KlineCanvas.c),this.vyChart.appendChild(this.KlineMaskCanvas.c),this.vyChart.appendChild(this.VolumeCanvas.c),this.vyChart.appendChild(this.XAxis.c),this.vyChart.appendChild(this.YAxis.c),this.vyChart.appendChild(this.VolYAxis.c),this.vyChart.appendChild(this.Dashboard.dashboardWrapper),this.vyChart.appendChild(this.BottomRightBlock.c)}},{key:"switchChartType",value:function(t){this.$store.commit("chart_type",t),this.initHistoryData(this.$store.state.all_kline_data)}},{key:"switchTheme",value:function(t){this.$store.commit("theme",this.THEME[t]),this.$watcher.emit(y.WATCHER_EVENT.THEME_SWITCHED,t),this.initHistoryData(this.$store.state.all_kline_data)}}]),n}(B));return mt.$store.commit("chart_instance",mt),window.vyChart=mt,mt}));
