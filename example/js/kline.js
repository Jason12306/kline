!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VyKline=e()}(this,(function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function e(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var i=function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t};function a(t,e){return t(e={exports:{}},e.exports),e.exports}var n=a((function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(a){return"function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?t.exports=i=function(t){return e(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},i(a)}t.exports=i}));var s=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var o=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?s(t):e},r=a((function(t){function e(i){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(i)}t.exports=e})),l=a((function(t){function e(i,a){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(i,a)}t.exports=e}));var c=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)},h={$createElement:function(t){return document.createElement(t)},$setElementAttribute:function(t,e,i){if("object"===n(i))for(var a in i)t[e][a]=i[a];else t.setAttribute(e,i)},$removeElementAttribute:function(t,e,i){t.removeAttribute(e,i)},$getElementAttribute:function(t,e){return t.getAttribute(e)}};function u(t,e){var i=(t=t<10?"0".concat(t):t).length,a=e.length>=t.length?i:e.length;return t.slice(i-a,i)}var d={Y:function(t,e){return u(String(t.getFullYear()),e)},M:function(t,e){return u(String(t.getMonth()+1),e)},D:function(t,e){return u(String(t.getDate()),e)},H:function(t,e){return u(String(t.getHours()),e)},m:function(t,e){return u(String(t.getMinutes()),e)},s:function(t,e){return u(String(t.getSeconds()),e)}},_=new(function(){function e(){t(this,e)}return i(e,[{key:"format",value:function(t,e){var i=t;if(!(t instanceof Date)&&(i=new Date(t),"Invalid Date"===String(i)))throw new Error("Invalid Date");return e.replace(/Y{1,}|M{1,}|D{1,}|H{1,}|m{1,}|s{1,}/g,(function(t){return d[t[0]](i,t)}))}}]),e}()),m={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e}};function v(t){for(var e,i=arguments.length,a=1;a<i;a++)e=1===a?arguments[a]:m[t](e,arguments[a]);return e}var f={},x=function(){function e(){t(this,e)}return i(e,[{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f[t]&&f[t].forEach((function(t){t(e)}))}},{key:"on",value:function(t,e){f[t]||(f[t]=[]),f[t].push(e)}}]),e}(),$=function(){function e(i){var a=this,n=i.state;t(this,e),this.state={};var s=this,o=function(t){Object.defineProperty(a.state,t,{configurable:!1,enumerable:!0,get:function(){return n[t]},set:function(e){void 0!==s[t]&&(n[t]=e)}})};for(var r in n)o(r)}return i(e,[{key:"commit",value:function(t,e){this[t]=t,this.state[t]=e}}]),e}(),g={DEFAULT_COLUMN_WIDTH:5,DEFAULT_COLUMN_SPACE:1,VIEW_CHANGE_TRIGGER_WAY:{SCALE:"SCALE"},CHART_TYPE:{KLINE:"KLINE",REAL_TIME:"REAL_TIME"},WATCHER_EVENT:{DRAG_MOUSE_MOVING:"dragMouseMoving",MOUSE_SCALING:"mouseScaling",ONE_DATA_UPDATED:"onOneDataUpdated",MOUSE_MOVING:"mouseMoving",REAL_TIME_DATA:"onRealTimeData",HISTORY_DATA_CHANGE:"historyDataChange",SWITCHED_INTERVAL:"switchedInterval"}},p=window.devicePixelRatio||1,y={scale_step:.2,max_scale:6,min_scale:1,x_axis_height:54,y_axis_width:54,axis_text_color:null,axis_segment:3,axis_color:null,default_rise_color:"#53b987",default_fall_color:"#eb4d5c",column_style:"solid",init_offset_x:100,volume_height:100,background_color:null,background_line_color:null,interval_tool_bar:"30px",precision:2,realtime_line_color:null,realtime_area_color:null},T={user_config:null,el:null,loadingNode:null,chart_instance:null,vy_chart:null,DEFAULT_COLUMN_WIDTH:g.DEFAULT_COLUMN_WIDTH*p,DEFAULT_COLUMN_SPACE:g.DEFAULT_COLUMN_SPACE*p,column_width:g.DEFAULT_COLUMN_WIDTH*p,column_space:g.DEFAULT_COLUMN_SPACE*p,current_interval:null,kline_data:[],all_kline_data:[],current_data:null,min:null,max:null,kline_canvas:null,current_mouse_coordinates:{x:null,y:null},current_cross_dash_line:{x:null,y:null},cross_is_in_newest_data:null,deedfeeds:null,y_axis_scale_list:[],YTag:null,realtime_tagY:null,axis_font:"".concat(12*p,"px Arial"),current_scale:1,no_scale_offset_x:y.init_offset_x,limit_offset_x:.25,every_data_px:null,overflow_data_num:0,ma_Lines:[{range:5,lineColor:"#583d7a"},{range:10,lineColor:"#95a4c7"}],chart_type:g.CHART_TYPE.KLINE},w={dark:{background_color:"#131722",axis_text_color:"#ccc",axis_color:"#ccc",background_line_color:"#363c4e",realtime_line_color:"#9397a4",realtime_area_color:"rgba(70, 80, 120, 0.6)"},light:{background_color:"#fff",axis_text_color:"#50535e",axis_color:"#50535e",background_line_color:"#e1ecf2",realtime_line_color:"#2196f3",realtime_area_color:"rgba(30, 150, 240, 0.2)"}};function b(t){return JSON.parse(JSON.stringify(t))}var E=new function e(){t(this,e),this.CONSTANTS=g,this.$Od=h,this.$time=_,this.$decimal=v,this.$copyObjectUnsafe=b,this.$watcher=new x,this.$store=new $({state:Object.assign(T,y)}),this.$handleCanvasDrawValue=function(t){return Math.round(t)+.5},this.$devicePixelRatio=window.devicePixelRatio||1},A=function(){function e(){for(var i in t(this,e),E)this[i]=E[i]}return i(e,[{key:"_customChart",value:function(t){var e=Object.keys(y),i=this.$store.state.user_config.theme,a=t;for(var n in w[i]||(i=a.theme||"light"),a=Object.assign({},w[i],a))e.includes(n)&&this.$store.commit(n,a[n]);a.init_offset_x&&this.$store.commit("no_scale_offset_x",a.init_offset_x)}},{key:"_clearScreen",value:function(t,e,i){t.clearRect(0,0,e,i)}},{key:"_drawBackground",value:function(t,e,i){t.beginPath(),t.globalAlpha=1,t.fillStyle=this.$store.state.background_color,t.fillRect(0,0,e,i)}},{key:"_handleDevicePixelRatio",value:function(t){var e=t.symbol,i=void 0===e?"*":e,a=t.value;return this.$decimal(i,a,this.$devicePixelRatio)}}]),e}();var D=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t};function C(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}var k=function(e){function a(e){var i,n=e._ctx,s=e.range;return t(this,a),(i=o(this,r(a).call(this)))._ctx=n,i.range=s,i}return c(a,e),i(a,[{key:"draw",value:function(){var t=this._handleMALineData();this._drawMALine(t)}},{key:"_handleMALineData",value:function(){var t=this,e=[],i=[];return this.$store.state.all_kline_data.slice(this.$store.state.overflow_data_num,2*this.$store.state.kline_data.length+this.$store.state.overflow_data_num).forEach((function(a,n,s){if(!(s.length-t.range-n<0)){i=s.slice(n,n+t.range);var o=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?C(i,!0).forEach((function(e){D(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},a,{avgClose:0}),r=0;i.forEach((function(e){r=t.$decimal("+",r,e.close)})),o.avgClose=t.$decimal("/",r,t.range),e.push(o),t.$store.state.kline_data[n]&&(t.$store.state.kline_data[n]["MAClose".concat(t.range)]=o.avgClose),i=[]}})),(e=e.slice(0,this.$store.state.kline_data.length)).forEach((function(e,i){Object.assign(e,t.$store.state.kline_data[i])})),e}},{key:"_drawMALine",value:function(t){var e=this;this._ctx.beginPath();var i=this.$store.state,a=i.el,n=i.x_axis_height,s=i.volume_height,o=i.min,r=i.every_data_px,l=i.column_width,c=a.offsetHeight,h=this.$decimal("-",c,n,s)*this.$devicePixelRatio;t.forEach((function(t,i,a){var n=e.$decimal("+",t.x,l/2),s=e.$decimal("-",h,(t.avgClose-o)*r);i?e._ctx.lineTo(n,s):(e._ctx.beginPath(),e._ctx.moveTo(n,s))})),this._ctx.stroke()}}]),a}(A),M=function(e){function a(){var e;return t(this,a),(e=o(this,r(a).call(this))).c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetWidth,e.$store.state.y_axis_width)}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetHeight,e.$store.state.x_axis_height,e.$store.state.volume_height)}),e.c.style.position="absolute",e.c.style.top=0,e.c.style.left=0,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$watcher.on(g.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.dragMouseMoving.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.MOUSE_SCALING,e.mouseScaling.bind(s(e))),e.mALineInstanceList=[],e.$store.state.ma_Lines.forEach((function(t){var i=new k({_ctx:e._ctx,range:t.range});e.mALineInstanceList.push(i)})),e}return c(a,e),i(a,[{key:"drawHistory",value:function(){var t=this,e=this.$store.state,i=e.y_axis_scale_list,a=e.background_line_color,n=(e.background_color,e.chart_type);switch(this._clearScreen(this._ctx,this.c.width,this.c.height),this._drawBackground(this._ctx,this.c.width,this.c.height),this._ctx.setLineDash([0]),i.forEach((function(e){t._ctx.beginPath(),t._ctx.strokeStyle=a,t._ctx.lineWidth=1;var i=Math.round(e)-.5;t._ctx.moveTo(0,i),t._ctx.lineTo(t.c.width,i),t._ctx.stroke()})),this._ctx.strokeStyle=this.$store.state.ma_Lines[0].lineColor,this.mALineInstanceList[0].draw(),this._ctx.strokeStyle=this.$store.state.ma_Lines[1].lineColor,this.mALineInstanceList[1].draw(),n){case this.CONSTANTS.CHART_TYPE.KLINE:this.drawKLine();break;case this.CONSTANTS.CHART_TYPE.REAL_TIME:this.drawRealTime();break;default:this.drawKLine()}this.drawRealTimeLine()}},{key:"drawKLine",value:function(){var t=this;this.$store.state.kline_data.forEach((function(e,i){var a=e.x,n=e.columnStartY,s=e.columnHeight,o=e.close,r=e.open,l=e.candleLineStartY,c=e.candleLineHeight,h=t.$store.state,u=h.column_width,d=h.default_rise_color,_=h.default_fall_color;t._ctx.strokeStyle=t._ctx.fillStyle=o>=r?d:_,t._ctx.lineWidth=1;var m=t.$handleCanvasDrawValue(t.$decimal("+",a,Math.floor(u/2)));t._ctx.beginPath(),t._ctx.moveTo(m,l),t._ctx.lineTo(m,l+c),t._ctx.lineWidth=1,t._ctx.stroke(),t._ctx.fillRect(Math.round(a),n,u,s)}))}},{key:"drawRealTime",value:function(){var t=this;this._ctx.beginPath();var e=this.$store.state,i=e.kline_data,a=e.column_width,n=e.realtime_line_color,s=e.realtime_area_color;i.forEach((function(e,i){var n=e.x,s=e.columnStartY,o=e.columnHeight,r=e.isRise,l=t.$handleCanvasDrawValue(t.$decimal("+",n,Math.floor(a/2))),c=r?s:t.$decimal("+",s,o);i?t._ctx.lineTo(l,c):t._ctx.moveTo(l,c)}));var o=i[0],r=i[i.length-1],l=this.$handleCanvasDrawValue(this.$decimal("+",r.x,Math.floor(a/2))),c=this.$handleCanvasDrawValue(this.$decimal("+",o.x,Math.floor(a/2)));this._ctx.lineTo(l,this.c.height),this._ctx.lineTo(c,this.c.height),this._ctx.lineWidth=1,this._ctx.strokeStyle=n,this._ctx.fillStyle=s,this._ctx.stroke(),this._ctx.fill()}},{key:"drawRealTimeLine",value:function(){var t=this.$store.state,e=t.max,i=t.min,a=t.all_kline_data,n=t.default_rise_color,s=t.default_fall_color,o=t.realtime_tagY,r=t.precision,l=a[0],c=l.close,h=l.open,u=(l.low,l.high,this.$decimal("-",e,i)),d=this.$decimal("/",this.c.height,u),_=this.$decimal("*",d,Math.abs(this.$decimal("-",h,c))),m=Math.min(h,c),v=this.$decimal("-",this.c.height,(m-i)*d,_),f=c>=h,x=f?n:s,$=f?v:this.$decimal("+",v,_);this._ctx.strokeStyle=x,this._ctx.beginPath(),this._ctx.lineWidth=1,this._ctx.setLineDash([2]),this._ctx.moveTo(0,$),this._ctx.lineTo(this.c.width,$),this._ctx.stroke(),o.innerText=c.toFixed(r),this.$Od.$setElementAttribute(o,"style",{top:"".concat(this._handleDevicePixelRatio({symbol:"/",value:$})-8,"px"),backgroundColor:x})}},{key:"dragMouseMoving",value:function(){this.drawHistory()}},{key:"mouseScaling",value:function(){this.drawHistory()}}]),a}(A);var S=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}};var O=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)};var R=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var P=function(t){return S(t)||O(t)||R()},N=function(e){function a(){return t(this,a),o(this,r(a).apply(this,arguments))}return c(a,e),i(a,[{key:"dealCanDrawViewData",value:function(t){var e,i=this,a=this.$store.state,n=a.el,s=a.x_axis_height,o=a.y_axis_width,r=a.column_space,l=a.column_width,c=a.init_offset_x,h=a.volume_height,u=n.offsetWidth,d=n.offsetHeight,_=this.$decimal("-",u,o)*this.$devicePixelRatio,m=this.$decimal("-",d,s,h)*this.$devicePixelRatio,v=this.$decimal("+",r,l),f=Math.ceil(_/v)+1,x=0,$=0;if(c>=0)e=this.$copyObjectUnsafe(t.slice(0,f));else{var g=Math.abs(c);$=Math.floor(this.$decimal("/",g,v)),x=this.$decimal("-",_,-g,this.$decimal("*",$,v),l),e=this.$copyObjectUnsafe(t.slice($,$+f))}this.$store.commit("overflow_data_num",$);var p=e.map((function(t){return t.high})),y=e.map((function(t){return t.low})),T=Math.max.apply(Math,P(p)),w=Math.min.apply(Math,P(y)),b=this.$decimal("-",T,w),E=this.$decimal("/",m,b);this.$store.commit("every_data_px",E);var A=e.map((function(t,e){var a=i.$decimal("*",v,e);t.x=c>=0?i.$decimal("-",_,c,a,l):i.$decimal("-",x,a),t.candleLineHeight=Math.round(i.$decimal("*",E,i.$decimal("-",t.high,t.low))),t.candleLineStartY=Math.round(i.$decimal("-",m,(t.low-w)*E,t.candleLineHeight));var n=Math.min(t.open,t.close);return t.columnHeight=Math.round(i.$decimal("*",E,Math.abs(i.$decimal("-",t.open,t.close)))),t.columnStartY=Math.round(i.$decimal("-",m,(n-w)*E,t.columnHeight)),t.isRise=t.close>=t.open,t}));this.$store.commit("kline_data",A),this.$store.commit("max",T),this.$store.commit("min",w)}}]),a}(A),L=function(e){function a(){var e;return t(this,a),(e=o(this,r(a).call(this))).mousemoveThrottleTimer=null,e.mousewheelThrottleTimer=null,e.c=e.$Od.$createElement("canvas"),e.c.style.position="absolute",e.c.style.zIndex=100,e.c.style.top=0,e.c.style.left=0,e.c.style.cursor="crosshair",e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetWidth,e.$store.state.y_axis_width)}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",e.$store.state.el.offsetHeight,e.$store.state.x_axis_height)}),e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.c.addEventListener("mousedown",e.mousedown.bind(s(e))),e.c.addEventListener("mouseup",e.mouseup.bind(s(e))),e.c.addEventListener("mousemove",e.mousemove.bind(s(e))),e.c.addEventListener("mouseleave",e.mouseleave.bind(s(e))),e.c.addEventListener("mouseenter",e.mouseenter.bind(s(e))),e.c.addEventListener("mousewheel",e.mousewheel.bind(s(e))),e.c.addEventListener("DOMMouseScroll",e.mousewheel.bind(s(e))),e.c.addEventListener("contextmenu",e.contextmenu.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.ONE_DATA_UPDATED,e.onOneDataUpdated.bind(s(e))),e.tagY=null,e.tagX=null,e.realTimeTagY=null,e.createXTag(),e.createYTag(),e.createRealTimeYTag(),e.INIT_OFFSET_X=e.$store.state.init_offset_x,e.limitOffsetX=e.$decimal("*",e.c.width,1-e.$store.state.limit_offset_x),e}return c(a,e),i(a,[{key:"drawCrossDottedLine",value:function(t,e){var i=e.x,a=e.y;this.$store.commit("current_cross_dash_line",{x:i,y:a});var n=this.$store.state,s=n.max,o=n.min,r=n.kline_data,l=n.column_width,c=n.volume_height,h=r[0].x,u=h<=i&&i<=this.$decimal("+",h,l);this.$store.commit("cross_is_in_newest_data",u);var d=this.$store.state.current_data.time,_=this._handleDevicePixelRatio({value:c}),m=this.$decimal("-",s,o),v=this.$decimal("/",m,this.c.height-_),f=this.$decimal("-",this.c.height,_,a),x=this.$decimal("+",this.$decimal("*",v,f),o);a>this.c.height-_?this.tagY.style.display="none":this.tagY.style.display="block",this.tagY.innerText=x.toFixed(2),this.tagY.style.top="".concat(this._handleDevicePixelRatio({symbol:"/",value:a})-8,"px"),this.tagX.innerText=this.$time.format(d,"YYYY-MM-DD HH:mm"),this.tagX.style.left="".concat(i/this.$devicePixelRatio,"px"),this._ctx.setLineDash([5]),this._ctx.strokeStyle="#758696",this._ctx.beginPath(),this._ctx.moveTo(0,a-.5),this._ctx.lineTo(this.c.width,a-.5),this._ctx.stroke(),this._ctx.beginPath();var $=this.$decimal("+",i,Math.ceil(this.$store.state.column_width/2))-.5;this._ctx.moveTo($,0),this._ctx.lineTo($,this.c.height),this._ctx.stroke()}},{key:"dragMousemove",value:function(t){var e=this.$store.state,i=e.all_kline_data,a=e.current_scale,n=e.init_offset_x;this.$store.commit("no_scale_offset_x",this.$decimal("/",n,a));var s=this.$decimal("*",this.$devicePixelRatio,this.$decimal("-",this.startDragX,t.layerX)),o=this.$decimal("+",this.INIT_OFFSET_X,s);o>this.limitOffsetX&&(o=this.limitOffsetX),this.$store.commit("init_offset_x",o),this.dealCanDrawViewData(i),this.$watcher.emit(g.WATCHER_EVENT.DRAG_MOUSE_MOVING)}},{key:"clearScreen",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height)}},{key:"mousemove",value:function(t){var e=this;null===this.mousemoveThrottleTimer&&(this.mousemoveThrottleTimer=window.requestAnimationFrame((function(){e.$store.commit("current_mouse_coordinates",{x:t.layerX*e.$devicePixelRatio,y:t.layerY*e.$devicePixelRatio}),e.canDragable?e.dragMousemove(t):e.$store.state.kline_data.every((function(i){var a=e.$decimal("+",i.x,e.$store.state.column_width);return!(i.x<=t.layerX*e.$devicePixelRatio&&i.x<=a)||(e.$store.commit("current_data",i),e.clearScreen(),e.drawCrossDottedLine(t,{x:i.x,y:t.layerY*e.$devicePixelRatio}),!1)})),e.$watcher.emit(g.WATCHER_EVENT.MOUSE_MOVING),window.cancelAnimationFrame(e.mousemoveThrottleTimer),e.mousemoveThrottleTimer=null})))}},{key:"mousewheel",value:function(t){var e=this;null===this.mousewheelThrottleTimer&&(this.mousewheelThrottleTimer=window.requestAnimationFrame((function(){var i=e.$store.state,a=i.scale_step,n=i.max_scale,s=i.min_scale,o=i.current_scale,r=i.all_kline_data,l=i.DEFAULT_COLUMN_WIDTH,c=i.DEFAULT_COLUMN_SPACE,h=i.no_scale_offset_x,u=o;t.deltaY<0||t.detail<0?e.$decimal("*",h,u)<=e.limitOffsetX&&o<n&&(u=e.$decimal("+",o,a)):o>s&&(u=e.$decimal("-",o,a)),e.$store.commit("current_scale",u);var d=e.$store.state.current_scale;e.$store.commit("init_offset_x",e.$decimal("*",h,d)),e.INIT_OFFSET_X=e.$store.state.init_offset_x,e.$store.commit("column_width",e.$decimal("*",l,d)),e.$store.commit("column_space",e.$decimal("*",c,d)),e.dealCanDrawViewData(r),e.$watcher.emit(g.WATCHER_EVENT.MOUSE_SCALING),window.cancelAnimationFrame(e.mousewheelThrottleTimer),e.mousewheelThrottleTimer=null})))}},{key:"mouseenter",value:function(){var t=this,e=setTimeout((function(){t.tagX.style.display="block",t.tagY.style.display="block",clearTimeout(e)}),50);e=null}},{key:"mouseleave",value:function(){var t=this;this.canDragable=!1,this.INIT_OFFSET_X=this.$store.state.init_offset_x;var e=setTimeout((function(){t.tagX.style.display="none",t.tagY.style.display="none",t.$store.commit("cross_is_in_newest_data",null),t.clearScreen(),clearTimeout(e)}),50);e=null}},{key:"mousedown",value:function(t){t.button||(this.startDragX=t.layerX,this.canDragable=!0,this.$Od.$setElementAttribute(this.c,"class","is-grabbing"))}},{key:"mouseup",value:function(t){t.button||(this.canDragable=!1,this.INIT_OFFSET_X=this.$store.state.init_offset_x,this.$Od.$removeElementAttribute(this.c,"class","is-grabbing"))}},{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"createRealTimeYTag",value:function(){this.realTimeTagY=this.$Od.$createElement("div"),this.$Od.$setElementAttribute(this.realTimeTagY,"id","real_time_volume"),this.$Od.$setElementAttribute(this.realTimeTagY,"style",{position:"absolute",zIndex:"80",right:0,width:"".concat(this.$store.state.y_axis_width,"px"),fontSize:"12px",textAlign:"center",color:"#fff",userSelect:"none"}),this.$store.state.vy_chart.appendChild(this.realTimeTagY),this.$store.commit("realtime_tagY",this.realTimeTagY)}},{key:"createYTag",value:function(){this.tagY=this.$Od.$createElement("div"),this.$Od.$setElementAttribute(this.tagY,"id","volume"),this.$Od.$setElementAttribute(this.tagY,"style",{position:"absolute",zIndex:"100",right:0,width:"".concat(this.$store.state.y_axis_width,"px"),fontSize:"12px",textAlign:"center",color:"#fff",backgroundColor:"#585858",userSelect:"none"}),this.$store.state.vy_chart.appendChild(this.tagY),this.$store.commit("YTag",this.tagY)}},{key:"createXTag",value:function(){this.tagX=this.$Od.$createElement("div"),this.$Od.$setElementAttribute(this.tagX,"id","date-time"),this.$Od.$setElementAttribute(this.tagX,"style",{position:"absolute",zIndex:"100",bottom:"".concat(this.$store.state.x_axis_height-44,"px"),fontSize:"12px",color:"#fff",backgroundColor:"#585858",transform:"translate(-50%, 0)",whiteSpace:"noWrap",userSelect:"none"}),this.$store.state.vy_chart.appendChild(this.tagX)}},{key:"onOneDataUpdated",value:function(t){this.$store.state.cross_is_in_newest_data&&(this.tagX.innerText=this.$time.format(t.time,"YYYY-MM-DD HH:mm"))}}]),a}(N),H=function(e){function a(){var e;t(this,a);var i=(e=o(this,r(a).call(this))).$store.state,n=i.el,l=i.x_axis_height,c=i.y_axis_width,h=i.volume_height;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:c}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",n.offsetHeight,l,h)}),e.c.style.position="absolute",e.c.style.top=0,e.c.style.right=0,e.c.style.background=e.$store.state.background_color,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$watcher.on(g.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.reDraw.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.MOUSE_SCALING,e.reDraw.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.REAL_TIME_DATA,e.reDraw.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.HISTORY_DATA_CHANGE,e.reDraw.bind(s(e))),e}return c(a,e),i(a,[{key:"draw",value:function(){this._drawBackground(this._ctx,this.c.width,this.c.height);var t=this.$store.state,e=t.min,i=t.max,a=t.axis_segment,n=t.axis_color,s=t.axis_text_color,o=t.axis_font;this._ctx.moveTo(.5,0),this._ctx.lineTo(.5,this.c.height),this._ctx.lineWidth=1,this._ctx.strokeStyle=n,this._ctx.stroke();for(var r=v("/",this.c.height,v("-",i,e)),l=0,c=Math.trunc(Math.log10(e))-1,h=Math.trunc(e/Math.pow(10,c))*Math.pow(10,c),u=Math.ceil(Math.log10(i-e))-2,d=5*Math.pow(10,u),_=5*Math.pow(10,u);d*r<40;)d=this.$decimal("+",d,_);this._ctx.strokeStyle=n,this._ctx.fillStyle=s,this._ctx.font=o;for(var m=[];h+d*l<i;){var f=h+d*l;f=f.toFixed(2);var x=this.c.height-r*(f-e),$=x-.5;m.push($),this._ctx.beginPath(),this._ctx.moveTo(0,$),this._ctx.lineTo(a,$),this._ctx.lineWidth=1,this._ctx.stroke(),this._ctx.fillText(f,5,x+4),l++}this.$store.commit("y_axis_scale_list",m)}},{key:"reDraw",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}}]),a}(A),I={m:function(t){return{time:Math.trunc(t.time/6e4),format:"HH:mm"}},h:function(t){return{time:Math.trunc(t.time/36e5),format:"DD HH:mm"}},d:function(t){return{time:Math.trunc(t.time/864e5),format:"MM-DD"}},w:function(t){return{time:Math.trunc(t.time/6048e5),format:"MM-DD"}},M:function(t){return{time:Math.trunc(t.time/2592e6),format:"YYYY-MM"}}},Y=function(e){function a(){var e;t(this,a);var i=(e=o(this,r(a).call(this))).$store.state,n=i.el,l=i.x_axis_height,c=i.y_axis_width;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",n.offsetWidth,c)}),e.c.height=e._handleDevicePixelRatio({value:l}),e.c.style.position="absolute",e.c.style.bottom=0,e.c.style.left=0,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e.c.style.background=e.$store.state.background_color,e._ctx=e.c.getContext("2d"),e.$watcher.on(g.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.reDraw.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.MOUSE_SCALING,e.reDraw.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.REAL_TIME_DATA,e.reDraw.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.HISTORY_DATA_CHANGE,e.reDraw.bind(s(e))),e}return c(a,e),i(a,[{key:"draw",value:function(){var t=this;this._drawBackground(this._ctx,this.c.width,this.c.height);var e=this.$store.state,i=e.axis_font,a=e.kline_data,n=e.current_scale,s=e.current_interval,o=e.column_width,r=e.axis_segment,l=e.axis_color,c=e.axis_text_color;if(a){this._ctx.moveTo(0,.5),this._ctx.lineTo(this.c.width,.5),this._ctx.lineWidth=1,this._ctx.strokeStyle=l,this._ctx.stroke(),this._ctx.textAlign="center";var h=s.match(/[0-9]*$/),u=s[0];this._ctx.strokeStyle=l,this._ctx.fillStyle=c,this._ctx.font=i,a.forEach((function(e,i){var a=I[u](e),s=a.time,l=a.format,c=Math.trunc(10*h/n);if(!(s%(c=5*Math.ceil(c/5)))){var d=t.$decimal("+",e.x,Math.ceil(o/2));t._ctx.beginPath(),t._ctx.moveTo(d-.5,0),t._ctx.lineTo(d-.5,r*t.$devicePixelRatio),t._ctx.stroke();var _=t.$time.format(e.time,l);t._ctx.fillText(_,d,15*t.$devicePixelRatio)}}))}}},{key:"reDraw",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}}]),a}(A),V=function(e){function a(){var e;t(this,a);var i=(e=o(this,r(a).call(this))).$store.state,n=i.el,l=i.x_axis_height,c=i.y_axis_width,h=i.volume_height;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$decimal("-",n.offsetWidth,c)}),e.c.height=e._handleDevicePixelRatio({value:h}),e.c.style.position="absolute",e.c.style.bottom="".concat(l,"px"),e.c.style.left=0,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.maxVolume=null,e.minVolume=null,e.dataGap=null,e.everyDataPX=null,e.YAxisStartX=e.$decimal("-",e._handleDevicePixelRatio({value:e.c.width}),c),e.$watcher.on(g.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.dragMouseMoving.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.MOUSE_SCALING,e.mouseScaling.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.REAL_TIME_DATA,e.onRealTimeData.bind(s(e))),e}return c(a,e),i(a,[{key:"drawTopLine",value:function(){var t=this.$store.state.axis_color;this._ctx.strokeStyle=t,this._ctx.beginPath(),this._ctx.moveTo(0,.5),this._ctx.lineTo(this.c.width,.5),this._ctx.lineWidth=1,this._ctx.stroke()}},{key:"draw",value:function(){var t=this;this._clearScreen(this._ctx,this.c.width,this.c.height),this._drawBackground(this._ctx,this.c.width,this.c.height),this.drawTopLine();var e=this.$store.state,i=e.kline_data,a=(e.volume_height,e.current_scale,e.y_axis_width,e.column_width),n=e.default_rise_color,s=e.default_fall_color,o=i.map((function(t){return t.volume}));this.maxVolume=Math.max.apply(Math,P(o)),this.minVolume=Math.min.apply(Math,P(o)),this.dataGap=this.$decimal("-",this.maxVolume,this.minVolume),this.everyDataPX=this.$decimal("/",this.c.height,this.dataGap),i.forEach((function(e){t._ctx.beginPath(),t._ctx.strokeStyle=t._ctx.fillStyle=e.close>=e.open?n:s;var i=t.$decimal("-",e.volume,t.minVolume),o=t.$decimal("*",t.everyDataPX,i),r=t.$decimal("-",t.c.height,o),l=e.x-.5;t._ctx.strokeRect(l,r,a,o),t._ctx.globalAlpha=.6,t._ctx.fillRect(l,r,a,o)}))}},{key:"dragMouseMoving",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height),this.draw()}},{key:"mouseScaling",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height),this.draw()}},{key:"onRealTimeData",value:function(){this._clearScreen(this._ctx,this.c.width,this.c.height),this.draw()}}]),a}(A),W=function(){function e(i,a){var n=a.data,s=void 0===n?0:n,o=a.html;t(this,e),this.span=i.$createElement("span"),this.html=o,this.data=s,this.span.innerHTML="".concat(o,'=<i style="color: ').concat(this.color,';">').concat(this.data,"</i>")}return i(e,[{key:"setData",value:function(t,e,i){this.data=t,this.span.innerHTML="".concat(this.html,'=<i style="color: ').concat(e,';">').concat(this.data,"</i>"),this.span.style.color=i}}]),e}(),U=function(e){function a(){var e;return t(this,a),(e=o(this,r(a).call(this))).dashboardWrapper=e.$Od.$createElement("div"),e.$Od.$setElementAttribute(e.dashboardWrapper,"id","dashboard-wrapper"),e.$Od.$setElementAttribute(e.dashboardWrapper,"style",{position:"absolute",zIndex:"50",left:0,top:0}),e.spanWrapper=e.$Od.$createElement("div"),e.$Od.$setElementAttribute(e.spanWrapper,"id","span-wrapper"),e.dashboardWrapper.appendChild(e.spanWrapper),e.openSpan=new W(e.$Od,{html:"开"}),e.highSpan=new W(e.$Od,{html:"高"}),e.lowSpan=new W(e.$Od,{html:"低"}),e.closeSpan=new W(e.$Od,{html:"收"}),e.volSpan=new W(e.$Od,{html:"Vol"}),e.MA5Span=new W(e.$Od,{html:"MA5"}),e.MA10Span=new W(e.$Od,{html:"MA10"}),e.spanWrapper.appendChild(e.openSpan.span),e.spanWrapper.appendChild(e.highSpan.span),e.spanWrapper.appendChild(e.lowSpan.span),e.spanWrapper.appendChild(e.closeSpan.span),e.spanWrapper.appendChild(e.volSpan.span),e.spanWrapper.appendChild(e.MA5Span.span),e.spanWrapper.appendChild(e.MA10Span.span),e.$watcher.on(g.WATCHER_EVENT.MOUSE_MOVING,e.mouseMoving.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.REAL_TIME_DATA,e.onRealTimeData.bind(s(e))),e}return c(a,e),i(a,[{key:"setSpanInnerText",value:function(t){var e=t.open,i=t.high,a=t.low,n=t.close,s=t.volume,o=t.MAClose5,r=void 0===o?0:o,l=t.MAClose10,c=void 0===l?0:l,h=this.$store.state,u=h.default_rise_color,d=h.default_fall_color,_=h.axis_text_color,m=h.ma_Lines,v=h.precision,f=n>=e?u:d;this.openSpan.setData(e.toFixed(v),f,_),this.highSpan.setData(i.toFixed(v),f,_),this.lowSpan.setData(a.toFixed(v),f,_),this.closeSpan.setData(n.toFixed(v),f,_),this.volSpan.setData(s,f,_),this.MA5Span.setData(r.toFixed(v),m[0].lineColor,_),this.MA10Span.setData(c.toFixed(v),m[1].lineColor,_)}},{key:"mouseMoving",value:function(){if(this.$store.state.current_data){var t=this.$store.state.current_data,e=t.open,i=t.high,a=t.low,n=t.close,s=t.volume,o=t.MAClose5,r=t.MAClose10;this.setSpanInnerText({open:e,high:i,low:a,close:n,volume:s,MAClose5:o,MAClose10:r})}}},{key:"onRealTimeData",value:function(){var t=this.$store.state,e=t.cross_is_in_newest_data,i=t.kline_data;if(e||null===e){var a=i[0],n=a.open,s=a.high,o=a.low,r=a.close,l=a.volume,c=a.MAClose5,h=a.MAClose10;this.setSpanInnerText({open:n,high:s,low:o,close:r,volume:l,MAClose5:c,MAClose10:h})}}}]),a}(A),X=/0{3}$/,G=function(e){function a(){var e;t(this,a);var i=(e=o(this,r(a).call(this))).$store.state,n=(i.el,i.x_axis_height),l=i.y_axis_width,c=i.volume_height;return e.c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:l}),e.c.height=e._handleDevicePixelRatio({value:e.$decimal("-",c)}),e.c.style.position="absolute",e.c.style.bottom="".concat(e.$decimal("-",n),"px"),e.c.style.right=0,e.c.style.background=e.$store.state.background_color,e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$watcher.on(g.WATCHER_EVENT.DRAG_MOUSE_MOVING,e.dragMouseMoving.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.MOUSE_SCALING,e.mouseScaling.bind(s(e))),e.$watcher.on(g.WATCHER_EVENT.REAL_TIME_DATA,e.onRealTimeData.bind(s(e))),e}return c(a,e),i(a,[{key:"draw",value:function(){this._drawBackground(this._ctx,this.c.width,this.c.height);var t=this.$store.state.axis_color;this._ctx.strokeStyle=t,this._ctx.beginPath(),this._ctx.moveTo(.5,0),this._ctx.lineTo(.5,this.c.height),this._ctx.lineWidth=1,this._ctx.stroke(),this.drawVolYAxis()}},{key:"drawVolYAxis",value:function(){var t=this.$store.state,e=t.kline_data,i=t.volume_height,a=t.axis_segment,n=t.axis_text_color,s=t.axis_font,o=e.map((function(t){return t.volume}));this.maxVolume=Math.max.apply(Math,P(o)),this.minVolume=Math.min.apply(Math,P(o)),this.dataGap=this.$decimal("-",this.maxVolume,this.minVolume);var r=this._handleDevicePixelRatio({value:i});this.everyDataPX=this.$decimal("/",r,this.dataGap);for(var l=Math.trunc(Math.log10(this.dataGap))-1,c=Math.trunc(this.minVolume),h=5*Math.pow(10,l),u=h;h*this.everyDataPX<20;)h=this.$decimal("+",h,u);this._ctx.fillStyle=n,this._ctx.font=s;for(var d=1;c+h*d<this.maxVolume;){var _=String(h*d);X.test(_)&&(_=_.replace(X,"k"));var m=this.c.height-this.everyDataPX*h*d;this._ctx.beginPath(),this._ctx.moveTo(0,m-.5),this._ctx.lineTo(a,m-.5),this._ctx.lineWidth=1,this._ctx.stroke(),this._ctx.fillText(_,5,m+this._handleDevicePixelRatio({value:4})),d++}}},{key:"dragMouseMoving",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}},{key:"mouseScaling",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}},{key:"onRealTimeData",value:function(){this._ctx.clearRect(0,0,this.c.width,this.c.height),this.draw()}}]),a}(A),F={m:{text:"Min"},h:{text:"Hour"},d:{text:"Day"},w:{text:"Week"},M:{text:"Mon"}},j=function(e){function a(){var e;return t(this,a),(e=o(this,r(a).call(this))).c=e.$Od.$createElement("div"),e.throttleTimer=null,e.$Od.$setElementAttribute(e.c,"id","interval_tool_bar"),e.$Od.$setElementAttribute(e.c,"style",{height:e.$store.state.interval_tool_bar,lineHeight:e.$store.state.interval_tool_bar,backgroundColor:e.$store.state.background_color}),e.$store.state.user_config.theme&&e.$Od.$setElementAttribute(e.c,"class",e.$store.state.user_config.theme),e.createTimeShareBtn(),e.createIntervalBtn(),e}return c(a,e),i(a,[{key:"createIntervalBtn",value:function(){var t=this,e=this.$store.state,i=e.user_config,a=e.chart_instance,n=i.interval,s=i.deedfeeds,o=i.onTimeIntervalChanged;n.forEach((function(e){var i=t.$Od.$createElement("button"),n=e.slice(1);i.innerText="".concat(n," ").concat(F[e[0]].text),t.$Od.$setElementAttribute(i,"class","interval-item"),t.$Od.$setElementAttribute(i,"data-interval-item",e);var r=t.$store.state,l=r.current_interval,c=r.loadingNode;l===e&&t.$Od.$setElementAttribute(i,"class","interval-item active"),i.onclick=function(){if(!t.throttleTimer){var n=t.$store.state,r=n.current_interval,l=n.chart_type;if(r===e&&l===t.CONSTANTS.CHART_TYPE.KLINE)return;t.throttleTimer=setTimeout((function(){"function"==typeof o&&o(e),c.style.display="block",t.$store.commit("chart_type",t.CONSTANTS.CHART_TYPE.KLINE),t.$store.commit("all_kline_data",[]),t.$store.commit("kline_data",[]),t.$store.commit("current_interval",e),t.$Od.$setElementAttribute(document.getElementsByClassName("interval-item active")[0],"class","interval-item"),t.$Od.$setElementAttribute(i,"class","interval-item active"),s.intervalChanged({interval:e,setHistoryData:a.initHistoryData,subscribeData:a.getRealTimeData}),t.throttleTimer=null}),200)}},t.c.appendChild(i)}))}},{key:"createTimeShareBtn",value:function(){var t=this,e=this.$store.state,i=e.user_config,a=e.chart_instance,n=e.loadingNode,s=i.deedfeeds,o=this.$Od.$createElement("button");o.innerText="分时",this.$Od.$setElementAttribute(o,"class","interval-item"),this.$Od.$setElementAttribute(o,"data-interval-item","time-sharing"),o.onclick=function(){n.style.display="block",t.$store.commit("chart_type",t.CONSTANTS.CHART_TYPE.REAL_TIME),t.$store.commit("all_kline_data",[]),t.$store.commit("current_interval","m1"),t.$Od.$setElementAttribute(document.getElementsByClassName("interval-item active")[0],"class","interval-item"),t.$Od.$setElementAttribute(o,"class","interval-item active"),s.intervalChanged({interval:"m1",setHistoryData:a.initHistoryData,subscribeData:a.getRealTimeData})},this.c.appendChild(o)}}]),a}(A),B=function(e){function a(){var e;t(this,a),(e=o(this,r(a).call(this))).c=e.$Od.$createElement("canvas"),e.c.width=e._handleDevicePixelRatio({value:e.$store.state.y_axis_width}),e.c.height=e._handleDevicePixelRatio({value:e.$store.state.x_axis_height}),e.c.style.width="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.width}),"px"),e.c.style.height="".concat(e._handleDevicePixelRatio({symbol:"/",value:e.c.height}),"px"),e._ctx=e.c.getContext("2d"),e.$Od.$setElementAttribute(e.c,"style",{position:"absolute",bottom:0,right:0,background:e.$store.state.background_color});var i=e.$store.state.axis_color;return e._ctx.moveTo(0,.5),e._ctx.lineTo(e.c.width,.5),e._ctx.moveTo(.5,0),e._ctx.lineTo(.5,e.c.height),e._ctx.lineWidth=1,e._ctx.strokeStyle=i,e._ctx.stroke(),e}return c(a,e),i(a,[{key:"draw",value:function(){}}]),a}(A);var K=new(function(e){function a(){var e;return t(this,a),(e=o(this,r(a).call(this))).customChart=null,e}return c(a,e),i(a,[{key:"bootstrap",value:function(t){var e=t.container,i=t.deedfeeds,a=t.defaultInterval,n=t.customChart,s=t.showIntervalToolbar,o=void 0===s||s,r=t.customLoadingEl;this.$store.commit("user_config",t),this.customChart=n,this._customChart(n),this.$store.commit("deedfeeds",i),this.$store.commit("current_interval",a),r?r instanceof HTMLElement&&(this.loading=r,this.$store.commit("loadingNode",this.loading),e.appendChild(this.loading)):(this.loading=function(t,e,i){var a=t.$createElement("div"),n=t.$createElement("div");return t.$setElementAttribute(a,"id","loading"),t.$setElementAttribute(n,"class","spin"),n.innerText="loading...",t.$setElementAttribute(a,"style",{display:"block",position:"absolute",zIndex:"9527",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255, 0.6)"}),a.appendChild(n),e.appendChild(a),a}(this.$Od,e,this.$store.state),this.$store.commit("loadingNode",this.loading)),this.intervalToolBarInstance=new j,e.appendChild(this.intervalToolBarInstance.c),this.intervalToolBarInstance.c.style.display=o?"block":"none",this.vyChart=function(t,e,i){var a=t.$createElement("div");return t.$setElementAttribute(a,"id","vy-chart"),t.$setElementAttribute(a,"style",{position:"absolute",bottom:0,width:"100%",height:"calc(100% - ".concat(i.interval_tool_bar,")")}),e.appendChild(a),a}(this.$Od,e,this.$store.state),this.$store.commit("el",this.vyChart),this.$store.commit("vy_chart",this.vyChart),e.style.position="relative",this.container=e,this.deedfeeds=i,this.KlineCanvas=null,this.YAxis=null,this.XAxis=null,this.Dashboard=null,this.VolumeCanvas=null,this.BottomRightBlock=null,this.initHistoryData=this.initHistoryData.bind(this),this.getRealTimeData=this.getRealTimeData.bind(this),i.setHistoryData({interval:a,setHistoryData:this.initHistoryData,subscribeData:this.getRealTimeData})}},{key:"initHistoryData",value:function(t){this.$store.commit("all_kline_data",t),this.dealCanDrawViewData(t),this.KlineCanvas||this.initViewOnce(),this.KlineCanvas.drawHistory(),this.VolumeCanvas.draw(),this.$watcher.emit(g.WATCHER_EVENT.HISTORY_DATA_CHANGE),this.loading.style.display="none"}},{key:"getRealTimeData",value:function(t){if(t.time){var e=this.$store.state.all_kline_data;e[0]&&(e[0].time===t.time?e[0]=t:(e.unshift(t),this.$watcher.emit(g.WATCHER_EVENT.ONE_DATA_UPDATED,t)),this.$store.commit("all_kline_data",e),this.initHistoryData(this.$store.state.all_kline_data),this.$watcher.emit(g.WATCHER_EVENT.REAL_TIME_DATA))}}},{key:"initViewOnce",value:function(){this.KlineCanvas=new M({backgroundColor:"#fff"}),this.$store.commit("kline_canvas",this.KlineCanvas),this.KlineMaskCanvas=new L,this.XAxis=new Y,this.YAxis=new H,this.VolYAxis=new G,this.VolumeCanvas=new V,this.Dashboard=new U,this.BottomRightBlock=new B,this.intervalToolBarInstance.c.style.backgroundColor=this.$store.state.background_color,this.XAxis.draw(),this.YAxis.draw(),this.VolYAxis.draw(),this.BottomRightBlock.draw(),this.vyChart.appendChild(this.KlineCanvas.c),this.vyChart.appendChild(this.KlineMaskCanvas.c),this.vyChart.appendChild(this.VolumeCanvas.c),this.vyChart.appendChild(this.XAxis.c),this.vyChart.appendChild(this.YAxis.c),this.vyChart.appendChild(this.VolYAxis.c),this.vyChart.appendChild(this.Dashboard.dashboardWrapper),this.vyChart.appendChild(this.BottomRightBlock.c)}},{key:"setChartType",value:function(){}},{key:"setRealTimeChart",value:function(){this.$store.commit("chart_type",this.CONSTANTS.CHART_TYPE.REAL_TIME)}},{key:"setKlineChart",value:function(){this.$store.commit("chart_type",this.CONSTANTS.CHART_TYPE.KLINE)}},{key:"switchTheme",value:function(){this.KlineCanvas.drawBackground()}}]),a}(N));return K.$store.commit("chart_instance",K),K}));
